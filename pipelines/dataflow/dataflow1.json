{
	"name": "dataflow1",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "amesproperty",
						"type": "DatasetReference"
					},
					"name": "amespropertycsv"
				},
				{
					"dataset": {
						"referenceName": "bsmtmongo",
						"type": "DatasetReference"
					},
					"name": "bsmt"
				},
				{
					"dataset": {
						"referenceName": "garagemongo",
						"type": "DatasetReference"
					},
					"name": "garage"
				},
				{
					"dataset": {
						"referenceName": "poolmongo",
						"type": "DatasetReference"
					},
					"name": "pool"
				},
				{
					"dataset": {
						"referenceName": "miscmongo",
						"type": "DatasetReference"
					},
					"name": "misc"
				},
				{
					"dataset": {
						"referenceName": "AzurePostgreSqlTable1",
						"type": "DatasetReference"
					},
					"name": "SQL"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "Salida",
						"type": "DatasetReference"
					},
					"name": "sink2"
				}
			],
			"transformations": [
				{
					"name": "ajustenulos"
				},
				{
					"name": "transformacion"
				},
				{
					"name": "ajustenulos2"
				},
				{
					"name": "ajustenulos3"
				},
				{
					"name": "ajustenulos4"
				},
				{
					"name": "ajustenulos5"
				},
				{
					"name": "CambioNombreBsmtt"
				},
				{
					"name": "CambioNombreGarage"
				},
				{
					"name": "CambioNombrePool"
				},
				{
					"name": "CambioNombreMisc"
				},
				{
					"name": "LeftJoinSQLPool"
				},
				{
					"name": "sort1"
				},
				{
					"name": "CambioNombreSQL"
				},
				{
					"name": "LeftJoinSQLMisc"
				},
				{
					"name": "LeftJoinSQLGarage"
				},
				{
					"name": "LeftJoinSQLBsmt"
				},
				{
					"name": "CambioNombreCSV"
				},
				{
					"name": "InnerJoinSQLCSV"
				},
				{
					"name": "select1"
				},
				{
					"name": "derivedColumn1"
				},
				{
					"name": "select2"
				}
			],
			"scriptLines": [
				"source(output(",
				"          PID as integer,",
				"          {Lot Frontage} as integer,",
				"          {Lot Area} as integer,",
				"          Street as string,",
				"          Alley as string,",
				"          {Lot Shape} as string,",
				"          {Land Contour} as string,",
				"          Utilities as string,",
				"          {Lot Config} as string,",
				"          {Land Slope} as string,",
				"          Neighborhood as string,",
				"          {Condition 1} as string,",
				"          {Condition 2} as string,",
				"          {Bldg Type} as string,",
				"          {House Style} as string,",
				"          {Overall Qual} as integer,",
				"          {Overall Cond} as integer,",
				"          {Year Built} as integer,",
				"          {Year Remod/Add} as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> amespropertycsv",
				"source(output(",
				"          {PID_$numberLong} as integer,",
				"          {Bsmt Qual} as string,",
				"          {Bsmt Cond} as string,",
				"          {Bsmt Exposure} as string,",
				"          {BsmtFin Type 1} as string,",
				"          {BsmtFin SF 1_$numberLong} as integer,",
				"          {BsmtFin Type 2} as string,",
				"          {BsmtFin SF 2_$numberLong} as integer,",
				"          {Bsmt Unf SF_$numberLong} as integer,",
				"          {Total Bsmt SF_$numberLong} as integer,",
				"          {Bsmt Full Bath_$numberLong} as integer,",
				"          {Bsmt Half Bath_$numberLong} as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> bsmt",
				"source(output(",
				"          {PID_$numberLong} as integer,",
				"          {Garage Type} as string,",
				"          {Garage Yr Blt_$numberLong} as integer,",
				"          {Garage Finish} as string,",
				"          {Garage Cars_$numberLong} as integer,",
				"          {Garage Area_$numberLong} as integer,",
				"          {Garage Qual} as string,",
				"          {Garage Cond} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> garage",
				"source(output(",
				"          {PID_$numberLong} as integer,",
				"          {Pool Area_$numberLong} as integer,",
				"          {Pool QC} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> pool",
				"source(output(",
				"          {PID_$numberLong} as integer,",
				"          {Misc Feature} as string,",
				"          {Misc Val_$numberLong} as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false) ~> misc",
				"source(output(",
				"          pid as integer,",
				"          {MS SubClass} as integer,",
				"          {MS Zoning} as string,",
				"          {Roof Style} as string,",
				"          {Roof Matl} as string,",
				"          {Exterior 1st} as string,",
				"          {Exterior 2nd} as string,",
				"          {Mas Vnr Type} as string,",
				"          {Mas Vnr Area} as integer,",
				"          {Exter Qual} as string,",
				"          {Exter Cond} as string,",
				"          foundation as string,",
				"          heating as string,",
				"          {Central Air} as integer,",
				"          electrical as string,",
				"          {1st Flr SF} as integer,",
				"          {2nd Flr SF} as integer,",
				"          {Low Qual Fin SF} as integer,",
				"          {Kitchen AbvGr} as integer,",
				"          {Heating QC} as string,",
				"          {Kitchen Qual} as string,",
				"          {TotRms AbvGrd} as integer,",
				"          functional as string,",
				"          fireplaces as integer,",
				"          {Fireplace Qu} as string,",
				"          {Paved Drive} as string,",
				"          {Wood Deck SF} as integer,",
				"          {Open Porch SF} as integer,",
				"          {Enclosed Porch} as integer,",
				"          {3Ssn Porch} as integer,",
				"          {Screen Porch} as integer,",
				"          fence as string,",
				"          Bedroom as integer,",
				"          {Full Bath} as integer,",
				"          {Half Bath} as integer,",
				"          {Gr Liv Area} as integer,",
				"          {Yr Sold} as integer,",
				"          {Mo Sold} as integer,",
				"          {Sale Type} as string,",
				"          {Sale Condition} as string,",
				"          saleprice as integer",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT\\n    am.PID as PID,\\n    am.\"MS SubClass\",\\n    ms.code AS \"MS Zoning\",\\n    am.\"Roof Style\",\\n    am.\"Roof Matl\",\\n    am.\"Exterior 1st\",\\n    am.\"Exterior 2nd\",\\n    am.\"Mas Vnr Type\",\\n    am.\"Mas Vnr Area\",\\n    t1.code AS \"Exter Qual\",\\n    t2.code AS \"Exter Cond\",\\n    am.Foundation,\\n    am.Heating,\\n    am.\"Central Air\",\\n    am.Electrical,\\n    am.\"1st Flr SF\",\\n    am.\"2nd Flr SF\",\\n    am.\"Low Qual Fin SF\",\\n    am.\"Kitchen AbvGr\",\\n    t3.code AS \"Heating QC\",\\n    t4.code AS \"Kitchen Qual\",\\n    am.\"TotRms AbvGrd\",\\n    am.Functional,\\n    am.Fireplaces,\\n    am.\"Fireplace Qu\",\\n    am.\"Paved Drive\",\\n    am.\"Wood Deck SF\",\\n    am.\"Open Porch SF\",\\n    am.\"Enclosed Porch\",\\n    am.\"3Ssn Porch\",\\n    am.\"Screen Porch\",\\n    am.Fence,\\n    fl.bedrooms AS \"Bedroom\",\\n    fl.\"Full Bath\",\\n    fl.\"Half Bath\",\\n    (am.\"1st Flr SF\" + am.\"2nd Flr SF\" + am.\"Low Qual Fin SF\") AS \"Gr Liv Area\",\\n    EXTRACT(YEAR FROM sp.\"Sale Date\") AS \"Yr Sold\",\\n    EXTRACT(MONTH FROM sp.\"Sale Date\") AS \"Mo Sold\",\\n    sp.\"Sale Type\",\\n    sp.\"Sale Condition\",\\n    sp.SalePrice\\nFROM amesdbtemp am\\nINNER JOIN mszoning ms\\n    ON am.\"MS Zoning\" = ms.id\\nINNER JOIN typequality t1\\n    ON am.\"Exter Qual\" = t1.id\\nINNER JOIN typequality t2\\n    ON am.\"Exter Cond\" = t2.id\\nINNER JOIN typequality t3\\n    ON am.\"Heating QC\" = t3.id\\nINNER JOIN typequality t4\\n    ON am.\"Kitchen Qual\" = t4.id\\nINNER JOIN (\\n        SELECT\\n            PID,\\n            SUM(bedrooms) AS bedrooms,\\n            SUM(\"Full Bath\") AS \"Full Bath\",\\n            SUM(\"Half Bath\") AS \"Half Bath\"\\n        FROM floordetail\\n        GROUP BY PID\\n    ) fl\\n    ON am.PID = fl.PID\\nINNER JOIN saleproperty sp\\n    ON am.PID = sp.PID\\nORDER BY am.PID\\n',",
				"     format: 'query') ~> SQL",
				"amespropertycsv derive(PID = iif(isNull(PID), 0, PID),",
				"          {Lot Frontage} = iif(isNull({Lot Frontage}), 0, {Lot Frontage}),",
				"          {Lot Area} = iif(isNull({Lot Area}), 0, {Lot Area}),",
				"          Street = iif(isNull(Street), 'NA', Street),",
				"          Alley = iif(isNull(Alley), 'NA', Alley),",
				"          {Lot Shape} = iif(isNull({Lot Shape}), 'NA', {Lot Shape}),",
				"          {Land Contour} = iif(isNull({Land Contour}), 'NA', {Land Contour}),",
				"          Utilities = iif(isNull(Utilities), 'NA', Utilities),",
				"          {Lot Config} = iif(isNull({Lot Config}), 'NA', {Lot Config}),",
				"          {Land Slope} = iif(isNull({Land Slope}), 'NA', {Land Slope}),",
				"          Neighborhood = iif(isNull(Neighborhood), 'NA', Neighborhood),",
				"          {Condition 1} = iif(isNull({Condition 1}), 'NA', {Condition 1}),",
				"          {Condition 2} = iif(isNull({Condition 2}), 'NA', {Condition 2}),",
				"          {Bldg Type} = iif(isNull({Bldg Type}), 'NA', {Bldg Type}),",
				"          {House Style} = iif(isNull({House Style}), 'NA', {House Style}),",
				"          {Overall Qual} = iif(isNull({Overall Qual}), 0, {Overall Qual}),",
				"          {Overall Cond} = iif(isNull({Overall Cond}), 0, {Overall Cond}),",
				"          {Year Built} = iif(isNull({Year Built}), 0, {Year Built}),",
				"          {Year Remod/Add} = iif(isNull({Year Remod/Add}), {Year Built}, {Year Remod/Add})) ~> ajustenulos",
				"ajustenulos derive(Neighborhood = iif(Neighborhood == 'Bloomington Heights', 'Blmngtn',\r",
				"iif(Neighborhood == 'Bluestem', 'Blueste',\r",
				"iif(Neighborhood == 'Briardale', 'BrDale',\r",
				"iif(Neighborhood == 'Brookside', 'BrkSide',\r",
				"iif(Neighborhood == 'Clear Creek', 'ClearCr',\r",
				"iif(Neighborhood == 'College Creek', 'CollgCr',\r",
				"iif(Neighborhood == 'Crawford', 'Crawfor',\r",
				"iif(Neighborhood == 'Edwards', 'Edwards',\r",
				"iif(Neighborhood == 'Gilbert', 'Gilbert',\r",
				"iif(Neighborhood == 'Iowa DOT and Rail Road', 'IDOTRR',\r",
				"iif(Neighborhood == 'Meadow Village', 'MeadowV',\r",
				"iif(Neighborhood == 'Mitchell', 'Mitchel',\r",
				"iif(Neighborhood == 'North Ames', 'Names',\r",
				"iif(Neighborhood == 'Northridge', 'NoRidge',\r",
				"iif(Neighborhood == 'Northpark Villa', 'NPkVill',\r",
				"iif(Neighborhood == 'Northridge Heights', 'NridgHt',\r",
				"iif(Neighborhood == 'Northwest Ames', 'NWAmes',\r",
				"iif(Neighborhood == 'Old Town', 'OldTown',\r",
				"iif(Neighborhood == 'South & West of Iowa State University', 'SWISU',\r",
				"iif(Neighborhood == 'Sawyer', 'Sawyer',\r",
				"iif(Neighborhood == 'Sawyer West', 'SawyerW',\r",
				"iif(Neighborhood == 'Somerset', 'Somerst',\r",
				"iif(Neighborhood == 'Stone Brook', 'StoneBr',\r",
				"iif(Neighborhood == 'Timberland', 'Timber',\r",
				"iif(Neighborhood == 'Veenker', 'Veenker', Neighborhood))))))))))))))))))))))))),",
				"          {Condition 1} = iif({Condition 1} == 'Adjacent to arterial street', 'Artery', iif({Condition 1} == 'Adjacent to feeder street', 'Feedr', iif({Condition 1} == 'Normal', 'Norm', iif({Condition 1} == \"Within 200' of North-South Railroad\", 'RRNn', iif({Condition 1} == 'Adjacent to North-South Railroad', 'RRAn', iif({Condition 1} == 'Near positive off-site feature--park greenbelt etc.', 'PosN', iif({Condition 1} == 'Adjacent to postive off-site feature', 'PosA', iif({Condition 1} == \"Within 200' of East-West Railroad\", 'RRNe', iif({Condition 1} == 'Adjacent to East-West Railroad', 'RRAe', {Condition 1}))))))))),",
				"          {Lot Shape} = iif({Lot Shape} == 'Regular', 'Reg', iif({Lot Shape} == 'Slightly irregular', 'IR1', iif({Lot Shape} == 'Moderately Irregular', 'IR2', iif({Lot Shape} == 'Irregular', 'IR3', 'NA'))))) ~> transformacion",
				"bsmt derive(each(match(type=='string'), $$ = iif(isNull($$), 'NA', $$)),",
				"          each(match(type=='integer'||type=='long'||type=='double'||type=='decimal'), $$ = iif(isNull($$), 0, $$))) ~> ajustenulos2",
				"garage derive(each(match(type=='string'), $$ = iif(isNull($$), 'NA', $$)),",
				"          each(match(type=='integer'||type=='long'||type=='double'||type=='decimal'), $$ = iif(isNull($$), 0, $$))) ~> ajustenulos3",
				"pool derive(each(match(type=='integer'||type=='long'||type=='double'||type=='decimal'), $$ = iif(isNull($$), 0, $$)),",
				"          each(match(type=='string'), $$ = iif(isNull($$), 'NA', $$))) ~> ajustenulos4",
				"misc derive(each(match(type=='string'), $$ = iif(isNull($$), 'NA', $$)),",
				"          each(match(type=='integer'), $$ = iif(isNull($$), 0, $$))) ~> ajustenulos5",
				"ajustenulos2 select(mapColumn(",
				"          PID_BSMT = {PID_$numberLong},",
				"          {Bsmt Qual},",
				"          {Bsmt Cond},",
				"          {Bsmt Exposure},",
				"          {BsmtFin Type 1},",
				"          {BsmtFin SF 1} = {BsmtFin SF 1_$numberLong},",
				"          {BsmtFin Type 2},",
				"          {BsmtFin SF 2} = {BsmtFin SF 2_$numberLong},",
				"          {Bsmt Unf SF} = {Bsmt Unf SF_$numberLong},",
				"          {Total Bsmt SF} = {Total Bsmt SF_$numberLong},",
				"          {Bsmt Full Bath} = {Bsmt Full Bath_$numberLong},",
				"          {Bsmt Half Bath} = {Bsmt Half Bath_$numberLong}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> CambioNombreBsmtt",
				"ajustenulos3 select(mapColumn(",
				"          PID_GARAGE = {PID_$numberLong},",
				"          {Garage Type},",
				"          {Garage Yr Blt} = {Garage Yr Blt_$numberLong},",
				"          {Garage Finish},",
				"          {Garage Cars} = {Garage Cars_$numberLong},",
				"          {Garage Area} = {Garage Area_$numberLong},",
				"          {Garage Qual},",
				"          {Garage Cond}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> CambioNombreGarage",
				"ajustenulos4 select(mapColumn(",
				"          PID_POOL = {PID_$numberLong},",
				"          {Pool Area} = {Pool Area_$numberLong},",
				"          {Pool QC}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> CambioNombrePool",
				"ajustenulos5 select(mapColumn(",
				"          PID_MISC = {PID_$numberLong},",
				"          {Misc Feature},",
				"          {Misc Val} = {Misc Val_$numberLong}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> CambioNombreMisc",
				"LeftJoinSQLMisc, CambioNombrePool join(PID == PID_POOL,",
				"     joinType:'left',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> LeftJoinSQLPool",
				"transformacion sort(asc(PID, true)) ~> sort1",
				"SQL select(mapColumn(",
				"          PID = pid,",
				"          {MS SubClass},",
				"          {MS Zoning},",
				"          {Roof Style},",
				"          {Roof Matl},",
				"          {Exterior 1st},",
				"          {Exterior 2nd},",
				"          {Mas Vnr Type},",
				"          {Mas Vnr Area},",
				"          {Exter Qual},",
				"          {Exter Cond},",
				"          Foundation = foundation,",
				"          Heating = heating,",
				"          {Central Air},",
				"          electrical,",
				"          {1st Flr SF},",
				"          {2nd Flr SF},",
				"          {Low Qual Fin SF},",
				"          {Kitchen AbvGr},",
				"          {Heating QC},",
				"          {Kitchen Qual},",
				"          {TotRms AbvGrd},",
				"          Functional = functional,",
				"          Fireplaces = fireplaces,",
				"          {Fireplace Qu},",
				"          {Paved Drive},",
				"          {Wood Deck SF},",
				"          {Open Porch SF},",
				"          {Enclosed Porch},",
				"          {3Ssn Porch},",
				"          {Screen Porch},",
				"          Fence = fence,",
				"          Bedroom,",
				"          {Full Bath},",
				"          {Half Bath},",
				"          {Gr Liv Area},",
				"          {Yr Sold},",
				"          {Mo Sold},",
				"          {Sale Type},",
				"          {Sale Condition},",
				"          SalePrice = saleprice",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> CambioNombreSQL",
				"CambioNombreSQL, CambioNombreMisc join(PID == PID_MISC,",
				"     joinType:'left',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> LeftJoinSQLMisc",
				"LeftJoinSQLPool, CambioNombreGarage join(PID == PID_GARAGE,",
				"     joinType:'left',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> LeftJoinSQLGarage",
				"LeftJoinSQLGarage, CambioNombreBsmtt join(PID == PID_BSMT,",
				"     joinType:'left',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> LeftJoinSQLBsmt",
				"sort1 select(mapColumn(",
				"          PID_ames = PID,",
				"          {Lot Frontage},",
				"          {Lot Area},",
				"          Street,",
				"          Alley,",
				"          {Lot Shape},",
				"          {Land Contour},",
				"          Utilities,",
				"          {Lot Config},",
				"          {Land Slope},",
				"          Neighborhood,",
				"          {Condition 1},",
				"          {Condition 2},",
				"          {Bldg Type},",
				"          {House Style},",
				"          {Overall Qual},",
				"          {Overall Cond},",
				"          {Year Built},",
				"          {Year Remod/Add}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> CambioNombreCSV",
				"LeftJoinSQLBsmt, CambioNombreCSV join(PID == PID_ames,",
				"     joinType:'inner',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> InnerJoinSQLCSV",
				"InnerJoinSQLCSV select(mapColumn(",
				"          each(match(!startsWith(name,'PID_')))",
				"     ),",
				"     skipDuplicateMapInputs: false,",
				"     skipDuplicateMapOutputs: true) ~> select1",
				"select1 derive(each(match(type=='integer'), $$ = iif(isNull($$),0,$$)),",
				"          each(match(type=='string'), $$ = iif(isNull($$),'NA',$$))) ~> derivedColumn1",
				"derivedColumn1 select(mapColumn(",
				"          YearRemodAdd = {Year Remod/Add},",
				"          Kitchen = {Kitchen AbvGr},",
				"          each(match(true()))",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select2",
				"select2 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     partitionFileNames:['Salida.csv'],",
				"     umask: 0022,",
				"     preCommands: [],",
				"     postCommands: [],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     partitionBy('hash', 1)) ~> sink2"
			]
		}
	}
}